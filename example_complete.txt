# Complete System Example: E-commerce Product Management
# This example demonstrates temporal versioning, guards, and decision policies working together

# Scenario: Managing product inventory with constraints and audit trail

# 1. Setup guards for data validation
GUARD ADD RANGE_INT price_guard price* 1 10000
GUARD ADD RANGE_INT stock_guard stock* 0 1000
GUARD ADD ENUM status_guard status* active,inactive,discontinued

# 2. List guards to verify
GUARD LIST

# 3. Set policy to DEV_FRIENDLY for initial testing
POLICY SET DEV_FRIENDLY
POLICY GET

# 4. Test product price updates (valid)
SET price 100
PROPOSE SET price 150
SET price 150
HISTORY price

# 5. Test invalid price update (out of range)
PROPOSE SET price 15000
# Expected: COUNTER_OFFER with alternatives (100, 5000)

# 6. Test stock management (valid)
SET stock 50
PROPOSE SET stock 75
SET stock 75

# 7. Test invalid stock (negative)
PROPOSE SET stock -10
# Expected: COUNTER_OFFER with 0 as alternative

# 8. Test status transitions (valid)
SET status active
PROPOSE SET status inactive
SET status inactive

# 9. Test invalid status
PROPOSE SET status pending
# Expected: COUNTER_OFFER showing: active, inactive, discontinued

# 10. Switch to SAFE_DEFAULT policy
POLICY SET SAFE_DEFAULT
POLICY GET

# 11. Test the same scenarios with balanced policy
PROPOSE SET price 15000
# Still shows alternatives (safe to negotiate)

PROPOSE SET status invalid_status
# Shows valid enum values

# 12. Switch to STRICT policy (production-ready)
POLICY SET STRICT
POLICY GET

# 13. Test with strict enforcement
PROPOSE SET price 15000
# Expected: REJECT (no alternatives shown)

PROPOSE SET status pending
# Expected: REJECT (no alternatives)

# 14. Valid operations still work in STRICT
PROPOSE SET price 200
SET price 200

# 15. Review temporal history
HISTORY price
HISTORY stock
HISTORY status

# 16. Query historical values
GET price AT 2026-01-01 00:00:00
EXPLAIN GET price AT 2026-01-01 00:00:00

# 17. Set retention policy to keep last 5 versions
CONFIG RETENTION LAST 5

# 18. Create many versions to test retention
SET price 100
SET price 110
SET price 120
SET price 130
SET price 140
SET price 150
HISTORY price
# Should only show last 5 versions

# 19. Create snapshot for persistence
SNAPSHOT

# 20. Reset to default policy
POLICY SET SAFE_DEFAULT

# Summary: This example shows:
# - Guard constraints protect data integrity
# - Decision policies control error handling behavior
# - Temporal versioning maintains complete audit trail
# - Retention policies manage history size
# - Snapshots enable persistence

EXIT
